(function(){"use strict";var n,G=document.createElement("div");G.innerHTML="<div class=wb-header><div class=wb-control><span class=wb-min></span><span class=wb-max></span><span class=wb-full></span><span class=wb-close></span></div><div class=wb-drag><div class=wb-icon></div><div class=wb-title></div></div></div><div class=wb-body></div><div class=wb-n></div><div class=wb-s></div><div class=wb-w></div><div class=wb-e></div><div class=wb-nw></div><div class=wb-ne></div><div class=wb-se></div><div class=wb-sw></div>";function l(t,i,s,h){t&&t.addEventListener(i,s,h||!1)}function R(t,i){var s=window,h=V;s&&s.removeEventListener(t,i,h||!1)}function B(t,i){t.stopPropagation(),i&&t.preventDefault()}function u(t,i,s){s=""+s,t["_s_"+i]!==s&&(t.style.setProperty(i,s),t["_s_"+i]=s)}var j=[],a=[],tt={capture:!0,passive:!1},V={capture:!0,passive:!0},g,ot=0,T=10,_,C,it,m,p,I;function M(t,i){if(!(this instanceof M))return new M(t);if(g||rt(),t){if(i){var s=t;t=i}if(typeof t=="string")s=t;else{var h=t.id,e=t.index,c=t.root,d=t.template;s=s||t.title;var w=t.icon,D=t.mount,A=t.html,o=t.url,f=t.width,v=t.height,x=t.minwidth,k=t.minheight,b=t.maxwidth,y=t.maxheight,Q=t.autosize,E=t.overflow,N=t.min,L=t.max,F=t.hidden,S=t.modal,$=t.x||(S?"center":0),X=t.y||(S?"center":0),P=t.top,U=t.left,H=t.bottom,J=t.right,nt=t.background,q=t.border,K=t.header,Y=t.class,ht=t.oncreate,ut=t.onclose,mt=t.onfocus,ct=t.onblur,dt=t.onmove,ft=t.onresize,vt=t.onfullscreen,at=t.onmaximize,gt=t.onminimize,wt=t.onrestore,xt=t.onhide,pt=t.onshow,bt=t.onload}}this.g=(d||G).cloneNode(!0),this.g.id=this.id=h||"winbox-"+ ++ot,this.g.className="winbox"+(Y?" "+(typeof Y=="string"?Y:Y.join(" ")):"")+(S?" modal":""),this.g.winbox=this,this.window=this.g,this.body=this.g.getElementsByClassName("wb-body")[0],this.h=K||35,a.push(this),nt&&this.setBackground(nt),q?u(this.body,"margin",q+(isNaN(q)?"":"px")):q=0,K&&(i=this.g.getElementsByClassName("wb-header")[0],u(i,"height",K+"px"),u(i,"line-height",K+"px"),u(this.body,"top",K+"px")),s&&this.setTitle(s),w&&this.setIcon(w),D?this.mount(D):A?this.body.innerHTML=A:o&&this.setUrl(o,bt),P=P?r(P,p):0,H=H?r(H,p):0,U=U?r(U,m):0,J=J?r(J,m):0,s=m-U-J,w=p-P-H,b=b?r(b,s):s,y=y?r(y,w):w,x=x?r(x,b):150,k=k?r(k,y):this.h,Q?((c||g).appendChild(this.body),f=Math.max(Math.min(this.body.clientWidth+2*q+1,b),x),v=Math.max(Math.min(this.body.clientHeight+this.h+q+1,y),k),this.g.appendChild(this.body)):(f=f?r(f,b):Math.max(b/2,x)|0,v=v?r(v,y):Math.max(y/2,k)|0),$=$?r($,s,f):U,X=X?r(X,w,v):P,this.x=$,this.y=X,this.width=f,this.height=v,this.s=x,this.o=k,this.m=b,this.l=y,this.top=P,this.right=J,this.bottom=H,this.left=U,this.index=e,this.j=E,this.focused=this.hidden=this.full=this.max=this.min=!1,this.onclose=ut,this.onfocus=mt,this.onblur=ct,this.onmove=dt,this.onresize=ft,this.onfullscreen=vt,this.onmaximize=at,this.onminimize=gt,this.onrestore=wt,this.onhide=xt,this.onshow=pt,F?this.hide():this.focus(),(e||e===0)&&(this.index=e,u(this.g,"z-index",e),e>T&&(T=e)),L?this.maximize():N?this.minimize():this.resize().move(),lt(this),(c||g).appendChild(this.g),ht&&ht.call(this,t)}M.new=function(t){return new M(t)},M.stack=function(){return a};function r(t,i,s){return typeof t=="string"&&(t==="center"?t=(i-s)/2+.5|0:t==="right"||t==="bottom"?t=i-s:(s=parseFloat(t),t=(""+s!==t&&t.substring((""+s).length))==="%"?i/100*s+.5|0:s)),t}function rt(){g=document.body,g[C="requestFullscreen"]||g[C="msRequestFullscreen"]||g[C="webkitRequestFullscreen"]||g[C="mozRequestFullscreen"]||(C=""),it=C&&C.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),l(window,"resize",function(){st(),O()}),l(g,"mousedown",function(){I=!1},!0),l(g,"mousedown",function(){if(!I){var t=a.length;if(t)for(--t;0<=t;t--){var i=a[t];if(i.focused){i.blur();break}}}}),st()}function lt(t){z(t,"drag"),z(t,"n"),z(t,"s"),z(t,"w"),z(t,"e"),z(t,"nw"),z(t,"ne"),z(t,"se"),z(t,"sw"),l(t.g.getElementsByClassName("wb-min")[0],"click",function(i){B(i),t.min?t.restore().focus():t.minimize()}),l(t.g.getElementsByClassName("wb-max")[0],"click",function(i){B(i),t.max?t.restore().focus():t.maximize().focus()}),C?l(t.g.getElementsByClassName("wb-full")[0],"click",function(i){B(i),t.fullscreen().focus()}):t.addClass("no-full"),l(t.g.getElementsByClassName("wb-close")[0],"click",function(i){B(i),t.close()||(t=null)}),l(t.g,"mousedown",function(){I=!0},!0),l(t.body,"mousedown",function(){t.focus()},!0)}function Z(t){j.splice(j.indexOf(t),1),O(),t.removeClass("min"),t.min=!1,t.g.title=""}function O(){for(var t=j.length,i={},s={},h=0,e;h<t;h++)e=j[h],e=e.left+":"+e.top,s[e]?s[e]++:(i[e]=0,s[e]=1);h=0;for(var c,d;h<t;h++)e=j[h],c=e.left+":"+e.top,d=Math.min((m-e.left-e.right)/s[c],250),e.resize(d+1|0,e.h,!0).move(e.left+i[c]*d|0,p-e.bottom-e.h,!0),i[c]++}function z(t,i){function s(o){if(B(o,!0),t.focus(),i==="drag"){if(t.min){t.restore();return}if(!t.g.classList.contains("no-max")){var f=Date.now(),v=f-A;if(A=f,300>v){t.max?t.restore():t.maximize();return}}}t.min||(g.classList.add("wb-lock"),(d=o.touches)&&(d=d[0])?(o=d,l(window,"touchmove",h,V),l(window,"touchend",e,V)):(l(window,"mousemove",h,V),l(window,"mouseup",e,V)),w=o.pageX,D=o.pageY)}function h(o){B(o),d&&(o=o.touches[0]);var f=o.pageX;o=o.pageY;var v=f-w,x=o-D,k=t.width,b=t.height,y=t.x,Q=t.y,E;if(i==="drag"){if(t.g.classList.contains("no-move"))return;t.x+=v,t.y+=x;var N=E=1}else{if(i==="e"||i==="se"||i==="ne"){t.width+=v;var L=1}else(i==="w"||i==="sw"||i==="nw")&&(t.x+=v,t.width-=v,N=L=1);if(i==="s"||i==="se"||i==="sw"){t.height+=x;var F=1}else(i==="n"||i==="ne"||i==="nw")&&(t.y+=x,t.height-=x,E=F=1)}L&&(t.width=Math.max(Math.min(t.width,t.m,m-t.x-t.right),t.s),L=t.width!==k),F&&(t.height=Math.max(Math.min(t.height,t.l,p-t.y-t.bottom),t.o),F=t.height!==b),(L||F)&&t.resize(),N&&(t.max&&(t.x=(f<m/3?t.left:f>m/3*2?m-t.width-t.right:m/2-t.width/2)+v),t.x=Math.max(Math.min(t.x,t.j?m-30:m-t.width-t.right),t.j?30-t.width:t.left),N=t.x!==y),E&&(t.max&&(t.y=t.top+x),t.y=Math.max(Math.min(t.y,t.j?p-t.h:p-t.height-t.bottom),t.top),E=t.y!==Q),(N||E)&&(t.max&&t.restore(),t.move()),(L||N)&&(w=f),(F||E)&&(D=o)}function e(o){B(o),g.classList.remove("wb-lock"),d?(R("touchmove",h),R("touchend",e)):(R("mousemove",h),R("mouseup",e))}var c=t.g.getElementsByClassName("wb-"+i)[0];if(c){var d,w,D,A=0;l(c,"mousedown",s,tt),l(c,"touchstart",s,tt)}}function st(){var t=document.documentElement;m=t.clientWidth,p=t.clientHeight}n=M.prototype,n.mount=function(t){return this.unmount(),t.i||(t.i=t.parentNode),this.body.textContent="",this.body.appendChild(t),this},n.unmount=function(t){var i=this.body.firstChild;if(i){var s=t||i.i;s&&s.appendChild(i),i.i=t}return this},n.setTitle=function(t){var i=this.g.getElementsByClassName("wb-title")[0];t=this.title=t;var s=i.firstChild;return s?s.nodeValue=t:i.textContent=t,this},n.setIcon=function(t){var i=this.g.getElementsByClassName("wb-icon")[0];return u(i,"background-image","url("+t+")"),u(i,"display","inline-block"),this},n.setBackground=function(t){return u(this.g,"background",t),this},n.setUrl=function(t,i){var s=this.body.firstChild;return s&&s.tagName.toLowerCase()==="iframe"?s.src=t:(this.body.innerHTML='<iframe src="'+t+'"></iframe>',i&&(this.body.firstChild.onload=i)),this},n.focus=function(t){if(t===!1)return this.blur();if(!this.focused){if(t=a.length,1<t)for(var i=1;i<=t;i++){var s=a[t-i];if(s.focused){s.blur(),a.push(a.splice(a.indexOf(this),1)[0]);break}}u(this.g,"z-index",++T),this.index=T,this.addClass("focus"),this.focused=!0,this.onfocus&&this.onfocus()}return this},n.blur=function(t){return t===!1?this.focus():(this.focused&&(this.removeClass("focus"),this.focused=!1,this.onblur&&this.onblur()),this)},n.hide=function(t){if(t===!1)return this.show();if(!this.hidden)return this.onhide&&this.onhide(),this.hidden=!0,this.addClass("hide")},n.show=function(t){if(t===!1)return this.hide();if(this.hidden)return this.onshow&&this.onshow(),this.hidden=!1,this.removeClass("hide")},n.minimize=function(t){return t===!1?this.restore():(_&&W(),this.max&&(this.removeClass("max"),this.max=!1),this.min||(j.push(this),O(),this.g.title=this.title,this.addClass("min"),this.min=!0,this.focused&&(this.blur(),et()),this.onminimize&&this.onminimize()),this)};function et(){var t=a.length;if(t)for(--t;0<=t;t--){var i=a[t];if(!i.min){i.focus();break}}}n.restore=function(){return _&&W(),this.min&&(Z(this),this.resize().move(),this.onrestore&&this.onrestore()),this.max&&(this.max=!1,this.removeClass("max").resize().move(),this.onrestore&&this.onrestore()),this},n.maximize=function(t){return t===!1?this.restore():(_&&W(),this.min&&Z(this),this.max||(this.addClass("max").resize(m-this.left-this.right,p-this.top-this.bottom,!0).move(this.left,this.top,!0),this.max=!0,this.onmaximize&&this.onmaximize()),this)},n.fullscreen=function(t){if(this.min&&(Z(this),this.resize().move()),!_||!W())this.body[C](),_=this,this.full=!0,this.onfullscreen&&this.onfullscreen();else if(t===!1)return this.restore();return this};function W(){if(_.full=!1,document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)return document[it](),!0}n.close=function(t){if(this.onclose&&this.onclose(t))return!0;this.min&&Z(this),a.splice(a.indexOf(this),1),this.unmount(),this.g.remove(),this.g.textContent="",this.g=this.body=this.g.winbox=null,this.focused&&et()},n.move=function(t,i,s){return t||t===0?s||(this.x=t?t=r(t,m-this.left-this.right,this.width):0,this.y=i?i=r(i,p-this.top-this.bottom,this.height):0):(t=this.x,i=this.y),u(this.g,"left",t+"px"),u(this.g,"top",i+"px"),this.onmove&&this.onmove(t,i),this},n.resize=function(t,i,s){return t||t===0?s||(this.width=t?t=r(t,this.m):0,this.height=i?i=r(i,this.l):0,t=Math.max(t,this.s),i=Math.max(i,this.o)):(t=this.width,i=this.height),u(this.g,"width",t+"px"),u(this.g,"height",i+"px"),this.onresize&&this.onresize(t,i),this},n.addControl=function(t){var i=t.class,s=t.image,h=t.click;t=t.index;var e=document.createElement("span"),c=this.g.getElementsByClassName("wb-control")[0],d=this;return i&&(e.className=i),s&&u(e,"background-image","url("+s+")"),h&&(e.onclick=function(w){h.call(this,w,d)}),c.insertBefore(e,c.childNodes[t||0]),this},n.removeControl=function(t){return(t=this.g.getElementsByClassName(t)[0])&&t.remove(),this},n.addClass=function(t){return this.g.classList.add(t),this},n.removeClass=function(t){return this.g.classList.remove(t),this},n.toggleClass=function(t){return this.g.classList.contains(t)?this.removeClass(t):this.addClass(t)},window.WinBox=M}).call(this);
